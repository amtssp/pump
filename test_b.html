<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>Insulinpumpe opstart</title>
<script src="pumps.js"></script>

<style>
body{
    font-family: Arial, sans-serif;
    margin:20px;
    background:#f9fbfd;
}

/* GRID LAYOUT */
.wrapper{
    display:grid;
    grid-template-columns: 420px 520px;
    gap:20px;
    align-items:start;
}

/* FELTER VENSTRE */
.section{
    background:#fff;
    padding:18px;
    border-radius:8px;
    box-shadow:0 1px 3px rgba(0,0,0,0.08);
}

.section h3{
    margin-top:0;
}

input, select{
    width:100%;
    padding:6px;
    box-sizing:border-box;
    margin-bottom:12px;
}

/* RESULTATBOKS */
.result-box{
    background:#ffeef3;
    padding:18px;
    border-radius:8px;
    box-shadow:0 1px 3px rgba(0,0,0,0.08);
}

.result-box h3{
    margin-top:0;
}

/* RESULTATRÆKKER */
.result-row{
    display:grid;
    grid-template-columns: 1fr 200px;
    align-items:center;
    margin-bottom:8px;
}

.result-row label{
    font-weight:bold;
}

.value{
    display:flex;
    align-items:center;
    gap:8px;
}

/* ENS INPUT STØRRELSE */
.calc-input{
    width:110px;
    padding:6px;
    box-sizing:border-box;
    background:#f4f6f8;
    border:1px solid #d9e2ec;
    border-radius:4px;
}

/* Pumpespecifikke felter alignes */
.pump-fields .field-row{
    display:grid;
    grid-template-columns: 1fr 200px;
    align-items:center;
    margin-bottom:8px;
}

.pump-fields .field-row input,
.pump-fields .field-row select{
    width:110px;
}

/* NOTE */
.note{
    font-size:12px;
    color:#555;
    margin-top:10px;
}

/* KNAP */
button{
    padding:8px 12px;
    border:none;
    border-radius:5px;
    background:#2a6fdb;
    color:white;
    cursor:pointer;
}

button:disabled{
    background:#b8c7e0;
    cursor:not-allowed;
}
</style>
</head>

<body>

<h2>Insulinpumpe opstart</h2>

<div class="wrapper">

<!-- VENSTRE SIDE -->
<div class="section">

<label>Total daglig insulin (IE)</label>
<input type="number" id="tdi">

<label>Vælg pumpe</label>
<select id="pumpModel">
<option value="">-- Vælg pumpe --</option>
</select>

</div>

<!-- HØJRE SIDE -->
<div class="result-box">

<h3 id="resultTitle">Pumpespecifikke indstillinger</h3>

<div class="result-row">
<label>Basal rate</label>
<div class="value">
<input type="number" id="basalRate" class="calc-input" step="0.01">
<span>IE/time</span>
</div>
</div>

<div class="result-row">
<label>Insulinfølsomhed</label>
<div class="value">
<input type="number" id="isf" class="calc-input" step="0.1">
<span>mmol/L per IE</span>
</div>
</div>

<div class="result-row">
<label>Kulhydratratio</label>
<div class="value">
<input type="number" id="icr" class="calc-input" step="1">
<span>g/IE</span>
</div>
</div>

<div class="note">
Automatisk beregnet – kan justeres
</div>

<hr style="margin:16px 0;">

<div id="pumpFields" class="pump-fields"></div>

<button id="copyBtn" disabled onclick="copyToClipboard()">Kopier indstillinger</button>
<div id="copyStatus" style="display:none;color:green;margin-top:8px;">Kopieret!</div>

</div>
</div>

<script>

const pumpModel = document.getElementById("pumpModel");
const pumpFieldsContainer = document.getElementById("pumpFields");
const tdiInput = document.getElementById("tdi");
const basalRateOutput = document.getElementById("basalRate");
const isfOutput = document.getElementById("isf");
const icrOutput = document.getElementById("icr");
const resultTitle = document.getElementById("resultTitle");
const copyBtn = document.getElementById("copyBtn");

/* Populate dropdown */
for(const key in pumps){
    const option=document.createElement("option");
    option.value=key;
    option.textContent=pumps[key].name;
    pumpModel.appendChild(option);
}

/* Beregning */
tdiInput.addEventListener("input", calculate);

function calculate(){
    const tdi=parseFloat(tdiInput.value);
    if(!tdi){ basalRateOutput.value=""; isfOutput.value=""; icrOutput.value=""; return;}

    const adjusted = tdi*0.8;

    basalRateOutput.value=((adjusted*0.4)/24).toFixed(2);
    isfOutput.value=(100/adjusted).toFixed(1);
    icrOutput.value=(450/adjusted).toFixed(0);
}

/* Pumpeskift */
pumpModel.addEventListener("change", ()=>{
    pumpFieldsContainer.innerHTML="";
    copyBtn.disabled = !pumpModel.value;

    if(!pumpModel.value){
        resultTitle.textContent="Pumpespecifikke indstillinger";
        return;
    }

    const pump=pumps[pumpModel.value];
    resultTitle.textContent=pump.name;

    if(pump.fields){
        pump.fields.forEach(f=>{
            const row=document.createElement("div");
            row.className="field-row";

            const label=document.createElement("label");
            label.textContent=f.label;

            const input=document.createElement("input");
            input.id="field_"+f.id;

            if(f.type==="number") input.type="number";
            if(f.type==="checkbox") input.type="checkbox";

            row.appendChild(label);
            row.appendChild(input);
            pumpFieldsContainer.appendChild(row);
        });
    }
});

/* Copy */
function copyToClipboard(){
    if(!pumpModel.value) return;

    const pump=pumps[pumpModel.value];

    let text="Insulinpumpe opstartsindstillinger\n";
    text+="=================================\n";
    text+="Pumpe: "+pump.name+"\n\n";

    text+=`Basal rate          ${basalRateOutput.value} IE/time\n`;
    text+=`Insulinfølsomhed    ${isfOutput.value} mmol/L per IE\n`;
    text+=`Kulhydratratio      ${icrOutput.value} g/IE\n\n`;

    if(pump.fields){
        pump.fields.forEach(f=>{
            const el=document.getElementById("field_"+f.id);
            if(!el) return;
            if(f.type==="checkbox"){
                text+=`${f.label}    ${el.checked?"Ja":"Nej"}\n`;
            }else{
                text+=`${f.label}    ${el.value?el.value:"skal udfyldes"}\n`;
            }
        });
    }

    navigator.clipboard.writeText(text).then(()=>{
        copyStatus.style.display="block";
        setTimeout(()=>copyStatus.style.display="none",2000);
    });
}
</script>

</body>
</html>
